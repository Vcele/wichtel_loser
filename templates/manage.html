{% extends "base.html" %}

{% block title %}Manage {{ event.name }} - Wichtel Loser{% endblock %}

{% block content %}
<div class="card">
    <h2>ğŸ“‹ Event Dashboard</h2>
    <p style="font-size: 1.3rem; margin-bottom: 0.5rem;">
        <strong>{{ event.name }}</strong>
    </p>
    <p style="color: rgba(255,255,255,0.7);">
        Status: 
        {% if event.status == "Open" %}
        <span style="color: #90ee90;">ğŸŸ¢ Open for participants</span>
        {% else %}
        <span style="color: var(--gold);">ğŸ”’ Closed - Assignments made!</span>
        {% endif %}
    </p>
</div>

<div class="card">
    <h2>ğŸ”— Invite Link</h2>
    <p style="margin-bottom: 1rem;">Share this link to invite participants:</p>
    <div class="copy-box">
        <code id="invite-link">{{ invite_url }}</code>
        <button class="copy-btn" onclick="copyInviteLink()">Copy</button>
    </div>
    <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">
        Invite Code: <strong>{{ event.invite_code }}</strong>
    </p>
</div>

<div class="card">
    <h2>ğŸ‘¥ Participants ({{ event.participants | length }})</h2>
    {% if event.participants | length > 0 %}
    <ul class="participant-list">
        {% for id, participant in event.participants %}
        <li class="participant-item">
            <div class="participant-avatar">ğŸ…</div>
            <div>
                <strong>{{ participant.name }}</strong>
                <div style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">
                    Joined {{ participant.joined_at }}
                </div>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p style="color: rgba(255,255,255,0.6); text-align: center; padding: 2rem;">
        No participants yet. Share your invite link!
    </p>
    {% endif %}
</div>

{% if event.status == "Open" %}
<div class="card">
    <h2>ğŸ² Close & Draw Names</h2>
    {% if can_close %}
    <p style="margin-bottom: 1rem;">
        Ready to assign Secret Santas? Once you close the event, no one else can join.
    </p>
    <form method="POST" action="/event/{{ event.id }}/close/{{ organizer_token }}" onsubmit="return confirm('Are you sure? This cannot be undone!');">
        <button type="submit" class="btn btn-gold btn-block">
            ğŸ„ Close Event & Draw Names
        </button>
    </form>
    {% else %}
    <p style="color: var(--gold); text-align: center; padding: 1rem;">
        âš ï¸ You need at least 2 participants to close the event.
    </p>
    {% endif %}
</div>
{% else %}
<div class="card" style="text-align: center;">
    <div style="font-size: 4rem; margin-bottom: 1rem;">âœ…</div>
    <h2>Assignments Complete!</h2>
    <p style="margin-bottom: 1rem;">
        Everyone has been assigned their Secret Santa recipient. 
        Participants can now visit the event link to see who they're buying for!
    </p>
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
    function copyInviteLink() {
        const link = window.location.origin + document.getElementById('invite-link').textContent;
        copyToClipboard(link);
    }
</script>
{% endblock %}
